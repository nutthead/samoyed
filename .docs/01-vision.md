# Samoyed

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC 2119](https://datatracker.ietf.org/doc/html/rfc2119).

## Vision

Build _Samoyed_, a cross-platform tool written in Rust that simplifies and streamlines how users work with client-side _Git Hooks_.

Samoyed avoids feature-creep. Also, fortunately, managing and working with client-side Git hooks is very simple. Consequently, the entire Rust code for Samoyed MUST fit in a single file, [`main.rs`](../src/main.rs).

Samoyed's source code has a 2nd file, [`samoyed`](../assets/samoyed), which is a POSIX shell script that is used as a Git hook wrapper. This file MUST be copied into the current repository's `[samoyed-dirname]/_` directory when `samoyed init` is executed inside a git repository.

**NOTE:** The `[samoyed-dirname]` is an optional argument to the `samoyed init` command. If not provided, it defaults to `.samoyed`.

## Coding Rules

* All the Rust code for Samoyed MUST fit and MUST reside in [`main.rs`](../src/main.rs)
* Mega functions, God Objects, and similar anti-patterns MUST be avoided
* Code MUST be split into as many functions as needed, and each function MUST have a "cognitive-complexity-threshold" less than or equal to 21
* A function MUST be split into two or more functions, if and only if, there is a logical reason to do so and the resulting code is more readable AND/OR easier to understand and test
* You MUST follow the [DRY](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself) principle
* You MUST write code with testability in mind and code that you write MUST be easily testable
* You MUST avoid overengineering
* You MUST document the code using rustdoc comments
* Samoyed is a CLI tool and not a library, therefore it MUST NOT have a `lib.rs` file

## CLI

### `samoyed`, `samoyed --help`, and `samoyed -h`

Running `samoyed`, `samoyed --help`, or `samoyed -h` MUST print the help message automatically generated by the [clap](https://crates.io/crates/clap) crate to `stdout` and exit with a zero exit code.

### `samoyed init [samoyed-dirname]`

**NOTE 1:** `[samoyed-dirname]` is an optional argument. If not provided, it defaults to `.samoyed`.
**NOTE 2:** `[samoyed-dirname]` MUST resolve to a path that is inside the current git repository. Otherwise, an error MUST be printed to `stderr` and the program MUST exit with a non-zero exit code. For example, `..` is not a valid value for `[samoyed-dirname]` if the current directory is the root of a git repository.

Running `samoyed init` outside a git repository MUST print an error message: `Error: Not a git repository` to `stderr` and exit with a non-zero exit code.

**NOTE 3:** To check if the current directory is inside a git repository, you MUST use the command `git rev-parse --is-inside-work-tree` and check its exit code. If and only if the exit code is zero AND the command's output is `true`, then the current directory is inside a git repository.

Running `samoyed init [samoyed-dirname]` inside a git repository:

* MUST create a `[samoyed-dirname]` directory in the root of the git repository, if it does not already exist
* MUST create a `[samoyed-dirname]/_` directory

Running `samoyed init [samoyed-dirname]` inside a git repository MUST copy [`assets/samoyed`](../assets/samoyed) to `[samoyed-dirname]/_` and set its permission to `644`:

Running `samoyed init [samoyed-dirname]` inside a git repository MUST also create the following files inside the `[samoyed-dirname]/_` directory (collectively referred to as the "hook scripts") and set the file permission for each of them to `755`:

* `applypatch-msg`
* `commit-msg`
* `post-applypatch`
* `post-checkout`
* `post-commit`
* `post-merge`
* `post-rewrite`
* `pre-applypatch`
* `pre-auto-gc`
* `pre-commit`
* `pre-merge-commit`
* `pre-push`
* `pre-rebase`
* `prepare-commit-msg`

All the hook scripts MUST contain the following code, including the last newline:

```sh
base_name=$(basename "$0")
abs_path=$(dirname "$(dirname "$0")")/$base_name

echo "Change me: ${abs_path}"

```

Running `samoyed init [samoyed-dirname]` inside a git repository MUST create a file named `[samoyed-dirname]/pre-commit`, a sample hook script, and set its file permissions to `644`. The file MUST contain the following code, including the last newline:

```sh
#!/usr/bin/env sh
. "$(dirname "$0")/samoyed"

```

**NOTE 4:** `[samoyed-dirname]` is an optional argument. If not provided, it defaults to `.samoyed`.

Running `samoyed init [samoyed-dirname]` inside a git repository:

* MUST use `git config` to set `core.hooksPath` for the current repository to `[samoyed-dirname]/_`